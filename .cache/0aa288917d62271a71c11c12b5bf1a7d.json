{"dependencies":[{"name":"./common.js","loc":{"line":17,"column":32}},{"name":"../ImageBase.js","loc":{"line":18,"column":22}},{"name":"../ImageState.js","loc":{"line":19,"column":23}},{"name":"../events.js","loc":{"line":20,"column":38}},{"name":"../events/EventType.js","loc":{"line":21,"column":22}},{"name":"../extent.js","loc":{"line":22,"column":64}},{"name":"../reproj.js","loc":{"line":23,"column":71}},{"name":"./Triangulation.js","loc":{"line":24,"column":26}}],"generated":{"js":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _common = require(\"./common.js\");\n\nvar _ImageBase = require(\"../ImageBase.js\");\n\nvar _ImageBase2 = _interopRequireDefault(_ImageBase);\n\nvar _ImageState = require(\"../ImageState.js\");\n\nvar _ImageState2 = _interopRequireDefault(_ImageState);\n\nvar _events = require(\"../events.js\");\n\nvar _EventType = require(\"../events/EventType.js\");\n\nvar _EventType2 = _interopRequireDefault(_EventType);\n\nvar _extent = require(\"../extent.js\");\n\nvar _reproj = require(\"../reproj.js\");\n\nvar _Triangulation = require(\"./Triangulation.js\");\n\nvar _Triangulation2 = _interopRequireDefault(_Triangulation);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar __extends = undefined && undefined.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n    return extendStatics(d, b);\n  };\n  return function (d, b) {\n    extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n/**\n * @module ol/reproj/Image\n */\n\n/**\n * @typedef {function(import(\"../extent.js\").Extent, number, number) : import(\"../ImageBase.js\").default} FunctionType\n */\n/**\n * @classdesc\n * Class encapsulating single reprojected image.\n * See {@link module:ol/source/Image~ImageSource}.\n */\nvar ReprojImage = /** @class */function (_super) {\n  __extends(ReprojImage, _super);\n  /**\n   * @param {import(\"../proj/Projection.js\").default} sourceProj Source projection (of the data).\n   * @param {import(\"../proj/Projection.js\").default} targetProj Target projection.\n   * @param {import(\"../extent.js\").Extent} targetExtent Target extent.\n   * @param {number} targetResolution Target resolution.\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {FunctionType} getImageFunction\n   *     Function returning source images (extent, resolution, pixelRatio).\n   */\n  function ReprojImage(sourceProj, targetProj, targetExtent, targetResolution, pixelRatio, getImageFunction) {\n    var _this = this;\n    var maxSourceExtent = sourceProj.getExtent();\n    var maxTargetExtent = targetProj.getExtent();\n    var limitedTargetExtent = maxTargetExtent ? (0, _extent.getIntersection)(targetExtent, maxTargetExtent) : targetExtent;\n    var targetCenter = (0, _extent.getCenter)(limitedTargetExtent);\n    var sourceResolution = (0, _reproj.calculateSourceResolution)(sourceProj, targetProj, targetCenter, targetResolution);\n    var errorThresholdInPixels = _common.ERROR_THRESHOLD;\n    var triangulation = new _Triangulation2.default(sourceProj, targetProj, limitedTargetExtent, maxSourceExtent, sourceResolution * errorThresholdInPixels);\n    var sourceExtent = triangulation.calculateSourceExtent();\n    var sourceImage = getImageFunction(sourceExtent, sourceResolution, pixelRatio);\n    var state = sourceImage ? _ImageState2.default.IDLE : _ImageState2.default.EMPTY;\n    var sourcePixelRatio = sourceImage ? sourceImage.getPixelRatio() : 1;\n    _this = _super.call(this, targetExtent, targetResolution, sourcePixelRatio, state) || this;\n    /**\n     * @private\n     * @type {import(\"../proj/Projection.js\").default}\n     */\n    _this.targetProj_ = targetProj;\n    /**\n     * @private\n     * @type {import(\"../extent.js\").Extent}\n     */\n    _this.maxSourceExtent_ = maxSourceExtent;\n    /**\n     * @private\n     * @type {!import(\"./Triangulation.js\").default}\n     */\n    _this.triangulation_ = triangulation;\n    /**\n     * @private\n     * @type {number}\n     */\n    _this.targetResolution_ = targetResolution;\n    /**\n     * @private\n     * @type {import(\"../extent.js\").Extent}\n     */\n    _this.targetExtent_ = targetExtent;\n    /**\n     * @private\n     * @type {import(\"../ImageBase.js\").default}\n     */\n    _this.sourceImage_ = sourceImage;\n    /**\n     * @private\n     * @type {number}\n     */\n    _this.sourcePixelRatio_ = sourcePixelRatio;\n    /**\n     * @private\n     * @type {HTMLCanvasElement}\n     */\n    _this.canvas_ = null;\n    /**\n     * @private\n     * @type {?import(\"../events.js\").EventsKey}\n     */\n    _this.sourceListenerKey_ = null;\n    return _this;\n  }\n  /**\n   * @inheritDoc\n   */\n  ReprojImage.prototype.disposeInternal = function () {\n    if (this.state == _ImageState2.default.LOADING) {\n      this.unlistenSource_();\n    }\n    _super.prototype.disposeInternal.call(this);\n  };\n  /**\n   * @inheritDoc\n   */\n  ReprojImage.prototype.getImage = function () {\n    return this.canvas_;\n  };\n  /**\n   * @return {import(\"../proj/Projection.js\").default} Projection.\n   */\n  ReprojImage.prototype.getProjection = function () {\n    return this.targetProj_;\n  };\n  /**\n   * @private\n   */\n  ReprojImage.prototype.reproject_ = function () {\n    var sourceState = this.sourceImage_.getState();\n    if (sourceState == _ImageState2.default.LOADED) {\n      var width = (0, _extent.getWidth)(this.targetExtent_) / this.targetResolution_;\n      var height = (0, _extent.getHeight)(this.targetExtent_) / this.targetResolution_;\n      this.canvas_ = (0, _reproj.render)(width, height, this.sourcePixelRatio_, this.sourceImage_.getResolution(), this.maxSourceExtent_, this.targetResolution_, this.targetExtent_, this.triangulation_, [{\n        extent: this.sourceImage_.getExtent(),\n        image: this.sourceImage_.getImage()\n      }], 0);\n    }\n    this.state = sourceState;\n    this.changed();\n  };\n  /**\n   * @inheritDoc\n   */\n  ReprojImage.prototype.load = function () {\n    if (this.state == _ImageState2.default.IDLE) {\n      this.state = _ImageState2.default.LOADING;\n      this.changed();\n      var sourceState = this.sourceImage_.getState();\n      if (sourceState == _ImageState2.default.LOADED || sourceState == _ImageState2.default.ERROR) {\n        this.reproject_();\n      } else {\n        this.sourceListenerKey_ = (0, _events.listen)(this.sourceImage_, _EventType2.default.CHANGE, function (e) {\n          var sourceState = this.sourceImage_.getState();\n          if (sourceState == _ImageState2.default.LOADED || sourceState == _ImageState2.default.ERROR) {\n            this.unlistenSource_();\n            this.reproject_();\n          }\n        }, this);\n        this.sourceImage_.load();\n      }\n    }\n  };\n  /**\n   * @private\n   */\n  ReprojImage.prototype.unlistenSource_ = function () {\n    (0, _events.unlistenByKey)( /** @type {!import(\"../events.js\").EventsKey} */this.sourceListenerKey_);\n    this.sourceListenerKey_ = null;\n  };\n  return ReprojImage;\n}(_ImageBase2.default);\nexports.default = ReprojImage;\n//# sourceMappingURL=Image.js.map"},"hash":"11b9dd0ce64aa6e96ca4ee80d2c24e63"}