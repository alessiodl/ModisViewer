{"dependencies":[{"name":"../../ImageCanvas.js","loc":{"line":17,"column":24}},{"name":"../../ViewHint.js","loc":{"line":18,"column":21}},{"name":"../../extent.js","loc":{"line":19,"column":62}},{"name":"../../obj.js","loc":{"line":20,"column":23}},{"name":"./ImageLayer.js","loc":{"line":21,"column":37}},{"name":"./VectorLayer.js","loc":{"line":22,"column":38}},{"name":"../../events/EventType.js","loc":{"line":23,"column":22}},{"name":"../../ImageState.js","loc":{"line":24,"column":23}},{"name":"../../render.js","loc":{"line":25,"column":37}},{"name":"../../transform.js","loc":{"line":26,"column":39}}],"generated":{"js":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _ImageCanvas = require(\"../../ImageCanvas.js\");\n\nvar _ImageCanvas2 = _interopRequireDefault(_ImageCanvas);\n\nvar _ViewHint = require(\"../../ViewHint.js\");\n\nvar _ViewHint2 = _interopRequireDefault(_ViewHint);\n\nvar _extent = require(\"../../extent.js\");\n\nvar _obj = require(\"../../obj.js\");\n\nvar _ImageLayer = require(\"./ImageLayer.js\");\n\nvar _ImageLayer2 = _interopRequireDefault(_ImageLayer);\n\nvar _VectorLayer = require(\"./VectorLayer.js\");\n\nvar _VectorLayer2 = _interopRequireDefault(_VectorLayer);\n\nvar _EventType = require(\"../../events/EventType.js\");\n\nvar _EventType2 = _interopRequireDefault(_EventType);\n\nvar _ImageState = require(\"../../ImageState.js\");\n\nvar _ImageState2 = _interopRequireDefault(_ImageState);\n\nvar _render = require(\"../../render.js\");\n\nvar _transform = require(\"../../transform.js\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar __extends = undefined && undefined.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n    return extendStatics(d, b);\n  };\n  return function (d, b) {\n    extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n/**\n * @module ol/renderer/canvas/VectorImageLayer\n */\n\n/**\n * @classdesc\n * Canvas renderer for image layers.\n * @api\n */\nvar CanvasVectorImageLayerRenderer = /** @class */function (_super) {\n  __extends(CanvasVectorImageLayerRenderer, _super);\n  /**\n   * @param {import(\"../../layer/VectorImage.js\").default} layer Vector image layer.\n   */\n  function CanvasVectorImageLayerRenderer(layer) {\n    var _this = _super.call(this, layer) || this;\n    /**\n     * @private\n     * @type {import(\"./VectorLayer.js\").default}\n     */\n    _this.vectorRenderer_ = new _VectorLayer2.default(layer);\n    /**\n     * @private\n     * @type {number}\n     */\n    _this.layerImageRatio_ = layer.getImageRatio();\n    /**\n     * @private\n     * @type {import(\"../../transform.js\").Transform}\n     */\n    _this.coordinateToVectorPixelTransform_ = (0, _transform.create)();\n    /**\n     * @private\n     * @type {import(\"../../transform.js\").Transform}\n     */\n    _this.renderedPixelToCoordinateTransform_ = null;\n    return _this;\n  }\n  /**\n   * @inheritDoc\n   */\n  CanvasVectorImageLayerRenderer.prototype.disposeInternal = function () {\n    this.vectorRenderer_.dispose();\n    _super.prototype.disposeInternal.call(this);\n  };\n  /**\n   * @inheritDoc\n   */\n  CanvasVectorImageLayerRenderer.prototype.getFeatures = function (pixel) {\n    if (this.vectorRenderer_) {\n      var vectorPixel = (0, _transform.apply)(this.coordinateToVectorPixelTransform_, (0, _transform.apply)(this.renderedPixelToCoordinateTransform_, pixel.slice()));\n      return this.vectorRenderer_.getFeatures(vectorPixel);\n    } else {\n      var promise = new Promise(function (resolve, reject) {\n        resolve([]);\n      });\n      return promise;\n    }\n  };\n  /**\n   * @inheritDoc\n   */\n  CanvasVectorImageLayerRenderer.prototype.handleFontsChanged = function () {\n    this.vectorRenderer_.handleFontsChanged();\n  };\n  /**\n   * @inheritDoc\n   */\n  CanvasVectorImageLayerRenderer.prototype.prepareFrame = function (frameState) {\n    var pixelRatio = frameState.pixelRatio;\n    var viewState = frameState.viewState;\n    var viewResolution = viewState.resolution;\n    var hints = frameState.viewHints;\n    var vectorRenderer = this.vectorRenderer_;\n    var renderedExtent = frameState.extent;\n    if (this.layerImageRatio_ !== 1) {\n      renderedExtent = renderedExtent.slice(0);\n      (0, _extent.scaleFromCenter)(renderedExtent, this.layerImageRatio_);\n    }\n    var width = (0, _extent.getWidth)(renderedExtent) / viewResolution;\n    var height = (0, _extent.getHeight)(renderedExtent) / viewResolution;\n    if (!hints[_ViewHint2.default.ANIMATING] && !hints[_ViewHint2.default.INTERACTING] && !(0, _extent.isEmpty)(renderedExtent)) {\n      vectorRenderer.useContainer(null, null, 1);\n      var context = vectorRenderer.context;\n      var imageFrameState_1 = /** @type {import(\"../../PluggableMap.js\").FrameState} */(0, _obj.assign)({}, frameState, {\n        declutterItems: [],\n        size: [width, height],\n        viewState: /** @type {import(\"../../View.js\").State} */(0, _obj.assign)({}, frameState.viewState, {\n          rotation: 0\n        })\n      });\n      var image_1 = new _ImageCanvas2.default(renderedExtent, viewResolution, pixelRatio, context.canvas, function (callback) {\n        if (vectorRenderer.prepareFrame(imageFrameState_1) && vectorRenderer.replayGroupChanged) {\n          vectorRenderer.renderFrame(imageFrameState_1, null);\n          (0, _render.renderDeclutterItems)(imageFrameState_1, null);\n          callback();\n        }\n      });\n      image_1.addEventListener(_EventType2.default.CHANGE, function () {\n        if (image_1.getState() === _ImageState2.default.LOADED) {\n          this.image_ = image_1;\n        }\n      }.bind(this));\n      image_1.load();\n    }\n    if (this.image_) {\n      var image = this.image_;\n      var imageResolution = image.getResolution();\n      var imagePixelRatio = image.getPixelRatio();\n      var renderedResolution = imageResolution * pixelRatio / imagePixelRatio;\n      this.renderedResolution = renderedResolution;\n      this.renderedPixelToCoordinateTransform_ = frameState.pixelToCoordinateTransform.slice();\n      this.coordinateToVectorPixelTransform_ = (0, _transform.compose)(this.coordinateToVectorPixelTransform_, width / 2, height / 2, 1 / renderedResolution, -1 / renderedResolution, 0, -viewState.center[0], -viewState.center[1]);\n    }\n    return !!this.image_;\n  };\n  /**\n   * @override\n   */\n  CanvasVectorImageLayerRenderer.prototype.preRender = function () {};\n  /**\n   * @override\n   */\n  CanvasVectorImageLayerRenderer.prototype.postRender = function () {};\n  /**\n   * @inheritDoc\n   */\n  CanvasVectorImageLayerRenderer.prototype.forEachFeatureAtCoordinate = function (coordinate, frameState, hitTolerance, callback, declutteredFeatures) {\n    if (this.vectorRenderer_) {\n      return this.vectorRenderer_.forEachFeatureAtCoordinate(coordinate, frameState, hitTolerance, callback, declutteredFeatures);\n    } else {\n      return _super.prototype.forEachFeatureAtCoordinate.call(this, coordinate, frameState, hitTolerance, callback, declutteredFeatures);\n    }\n  };\n  return CanvasVectorImageLayerRenderer;\n}(_ImageLayer2.default);\nexports.default = CanvasVectorImageLayerRenderer;\n//# sourceMappingURL=VectorImageLayer.js.map"},"hash":"6dcbcab02355d7cf1a0465404a3de920"}