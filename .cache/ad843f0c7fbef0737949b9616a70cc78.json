{"dependencies":[{"name":"../css.js","loc":{"line":17,"column":35}},{"name":"../layer/Layer.js","loc":{"line":18,"column":23}},{"name":"../render/Event.js","loc":{"line":19,"column":24}},{"name":"../render/EventType.js","loc":{"line":20,"column":28}},{"name":"./Map.js","loc":{"line":21,"column":24}},{"name":"../source/State.js","loc":{"line":22,"column":24}},{"name":"../dom.js","loc":{"line":23,"column":32}},{"name":"../render/canvas.js","loc":{"line":24,"column":27}},{"name":"../events/EventType.js","loc":{"line":25,"column":22}},{"name":"../events.js","loc":{"line":26,"column":38}}],"generated":{"js":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _css = require(\"../css.js\");\n\nvar _Layer = require(\"../layer/Layer.js\");\n\nvar _Event = require(\"../render/Event.js\");\n\nvar _Event2 = _interopRequireDefault(_Event);\n\nvar _EventType = require(\"../render/EventType.js\");\n\nvar _EventType2 = _interopRequireDefault(_EventType);\n\nvar _Map = require(\"./Map.js\");\n\nvar _Map2 = _interopRequireDefault(_Map);\n\nvar _State = require(\"../source/State.js\");\n\nvar _State2 = _interopRequireDefault(_State);\n\nvar _dom = require(\"../dom.js\");\n\nvar _canvas = require(\"../render/canvas.js\");\n\nvar _EventType3 = require(\"../events/EventType.js\");\n\nvar _EventType4 = _interopRequireDefault(_EventType3);\n\nvar _events = require(\"../events.js\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar __extends = undefined && undefined.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n    return extendStatics(d, b);\n  };\n  return function (d, b) {\n    extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n/**\n * @module ol/renderer/Composite\n */\n\n/**\n * @classdesc\n * Canvas map renderer.\n * @api\n */\nvar CompositeMapRenderer = /** @class */function (_super) {\n  __extends(CompositeMapRenderer, _super);\n  /**\n   * @param {import(\"../PluggableMap.js\").default} map Map.\n   */\n  function CompositeMapRenderer(map) {\n    var _this = _super.call(this, map) || this;\n    /**\n     * @type {import(\"../events.js\").EventsKey}\n     */\n    _this.labelCacheKey_ = (0, _events.listen)(_canvas.labelCache, _EventType4.default.CLEAR, map.redrawText.bind(map));\n    /**\n     * @private\n     * @type {HTMLDivElement}\n     */\n    _this.element_ = document.createElement('div');\n    var style = _this.element_.style;\n    style.position = 'absolute';\n    style.width = '100%';\n    style.height = '100%';\n    style.zIndex = '0';\n    _this.element_.className = _css.CLASS_UNSELECTABLE + ' ol-layers';\n    var container = map.getViewport();\n    container.insertBefore(_this.element_, container.firstChild || null);\n    /**\n     * @private\n     * @type {Array<HTMLElement>}\n     */\n    _this.children_ = [];\n    /**\n     * @private\n     * @type {boolean}\n     */\n    _this.renderedVisible_ = true;\n    return _this;\n  }\n  /**\n   * @param {import(\"../render/EventType.js\").default} type Event type.\n   * @param {import(\"../PluggableMap.js\").FrameState} frameState Frame state.\n   */\n  CompositeMapRenderer.prototype.dispatchRenderEvent = function (type, frameState) {\n    var map = this.getMap();\n    if (map.hasListener(type)) {\n      var event_1 = new _Event2.default(type, undefined, frameState);\n      map.dispatchEvent(event_1);\n    }\n  };\n  CompositeMapRenderer.prototype.disposeInternal = function () {\n    (0, _events.unlistenByKey)(this.labelCacheKey_);\n    _super.prototype.disposeInternal.call(this);\n  };\n  /**\n   * @inheritDoc\n   */\n  CompositeMapRenderer.prototype.renderFrame = function (frameState) {\n    if (!frameState) {\n      if (this.renderedVisible_) {\n        this.element_.style.display = 'none';\n        this.renderedVisible_ = false;\n      }\n      return;\n    }\n    this.calculateMatrices2D(frameState);\n    this.dispatchRenderEvent(_EventType2.default.PRECOMPOSE, frameState);\n    var layerStatesArray = frameState.layerStatesArray.sort(function (a, b) {\n      return a.zIndex - b.zIndex;\n    });\n    var viewState = frameState.viewState;\n    this.children_.length = 0;\n    var previousElement = null;\n    for (var i = 0, ii = layerStatesArray.length; i < ii; ++i) {\n      var layerState = layerStatesArray[i];\n      frameState.layerIndex = i;\n      if (!(0, _Layer.inView)(layerState, viewState) || layerState.sourceState != _State2.default.READY && layerState.sourceState != _State2.default.UNDEFINED) {\n        continue;\n      }\n      var layer = layerState.layer;\n      var element = layer.render(frameState, previousElement);\n      if (!element) {\n        continue;\n      }\n      if (element !== previousElement) {\n        this.children_.push(element);\n        previousElement = element;\n      }\n    }\n    _super.prototype.renderFrame.call(this, frameState);\n    (0, _dom.replaceChildren)(this.element_, this.children_);\n    this.dispatchRenderEvent(_EventType2.default.POSTCOMPOSE, frameState);\n    if (!this.renderedVisible_) {\n      this.element_.style.display = '';\n      this.renderedVisible_ = true;\n    }\n    this.scheduleExpireIconCache(frameState);\n  };\n  /**\n   * @inheritDoc\n   */\n  CompositeMapRenderer.prototype.forEachLayerAtPixel = function (pixel, frameState, hitTolerance, callback, layerFilter) {\n    var viewState = frameState.viewState;\n    var layerStates = frameState.layerStatesArray;\n    var numLayers = layerStates.length;\n    for (var i = numLayers - 1; i >= 0; --i) {\n      var layerState = layerStates[i];\n      var layer = layerState.layer;\n      if (layer.hasRenderer() && (0, _Layer.inView)(layerState, viewState) && layerFilter(layer)) {\n        var layerRenderer = layer.getRenderer();\n        var data = layerRenderer.getDataAtPixel(pixel, frameState, hitTolerance);\n        if (data) {\n          var result = callback(layer, data);\n          if (result) {\n            return result;\n          }\n        }\n      }\n    }\n    return undefined;\n  };\n  return CompositeMapRenderer;\n}(_Map2.default);\nexports.default = CompositeMapRenderer;\n//# sourceMappingURL=Composite.js.map"},"hash":"3a0d0fe63107fe8b51dc38b21c5031a6"}